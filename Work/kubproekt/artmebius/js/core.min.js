function footer_fix() {
	jQuery('#ftr_ndr').height(jQuery('#ftr').outerHeight());
}
jQuery.fn.scrollToTop = function() {
	var btn = jQuery(this);
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 100) {
			jQuery(btn).fadeIn("slow");
		} else {
			jQuery(btn).fadeOut("fast");
		}
	});
	jQuery(this).click(function() {
		jQuery("html, body").animate({
			scrollTop: 0
		}, "slow")
	})
}

function initLightBox() {
	jQuery('.lightbox').colorbox({
		speed: 200,
		// rel: 'gal',
		maxHeight: '90%',
		maxWidth: '90%',
		slideshow: true,
		fixed: true,
		current: "{current} из {total}",
		previous: "назад",
		next: "вперёд",
		close: "закрыть",
		xhrError: "Не удалось загрузить содержимое.",
		imgError: "Не удалось загрузить изображение.",
		slideshowSpeed: 5000,
		slideshowStart: "начать слайд-шоу",
		slideshowStop: "остановить слайд-шоу"
	});
}

// устанавливаем элементу высоту строки равную собственной высоте
function upd_line_height(parent, target) {
	var selector = parent + ' ' + target;
	jQuery(selector).css('height', 'auto');
	jQuery(selector).each(function(index, e) {
		jQuery(e).css('height', jQuery(e).height() + 'px');
	});
}

function update_height(line, block){
	var maxH=0;
	$(line).each(function(){
		$(this).find(block).each(function(){
			if ($(this).height()>maxH) {
				maxH=$(this).height();
			}
		});   
		$(this).find(block).height(maxH);
	});
}

function update_height_cols(parent, target) {
	var parent = '.' + parent;
	var target = '.' + target;
	jQuery(parent).find(target).height('auto');
	var iArr = new Array();
	jQuery(parent + ' .tiles_col').each(function() {
		if (jQuery(this).css('clear') == 'both') {
			iArr.push(jQuery(this).index());
		}
	});
	var eArr = '';
	iArr.forEach(function(el, index) {
		if (iArr[index + 1]) {
			eArr = jQuery(parent + ' .tiles_col').slice(el, iArr[index + 1]);
		} else {
			eArr = jQuery(parent + ' .tiles_col').slice(el);
		}
		if (jQuery(document).width() > 320) {
			maxH = 0;
			eArr.each(function(index, el) {
				if (maxH < jQuery(el).find(target).height()) {
					maxH = jQuery(el).find(target).height();
				}
			});
			eArr.each(function(index, el) {
				jQuery(el).find(target).height(maxH);
			});
		}
	});
}

function slideToggleAny(button, target, speed) {
	jQuery(button).click(function(event) {
		event.preventDefault();
		jQuery(target).slideToggle(speed);
	});
}

function table_responsive() {
	jQuery('table.table-responsive').each(function() {
		if (!jQuery(this).parent().is('.table-responsive')){
			jQuery(this).wrap('<div class="table-responsive"></div>');
		}
	});
}

function init_table_responsive(parent) {
	jQuery(parent).find('table').each(function(index, e) {
		if (!jQuery(e).hasClass('table-responsive')){
			jQuery(e).wrap('<div class="table-responsive"></div>');
		}
	});
}

function initMenuAccord() {
	jQuery('.menu.menu_vert_accord .parent a').click(function() {
		if (jQuery(this).siblings('ul').length) {
			var ulParent = jQuery(this).children(".menu-toggler").closest("ul");
			jQuery(this).siblings('ul').slideToggle(300);
			return false;
		}
	})
}

function initSwitcherMenu(mdl) {
	jQuery(mdl + ' .menu_switcher a').click(function(event) {
		event.preventDefault();
		jQuery(this).toggleClass('active').parent().siblings('.menu').slideToggle(300);
	});
	jQuery(mdl + ' .menu_horz_multi a').click(function(event) {
		if (jQuery(document).width() <= 751) {
			if (jQuery(this).next('ul').length) {
				event.preventDefault();
				jQuery(this).parent().siblings('li').children('ul:visible').slideToggle(300);
				jQuery(this).next('ul').slideToggle(300);
			}
		}
	});
}

function initMenuAccordParents(mdl, icon){
	var target = (icon) ? '.parent_blt' : 'a';
	jQuery(mdl + ' .menu_vert_accord '+ target).click(function(event){
		event.stopPropagation();
		var thisA = (icon) ? jQuery(this).parent('a') : jQuery(this);
		var nextUl=thisA.next('ul');
		var visUl=thisA.parent().siblings('li').children('ul:visible');
		var prevA=visUl.prev('a');
		var icon_opened='icon-minus-square-o';
		var icon_closed='icon-plus-square-o';
		if (nextUl.length){
			//event.preventDefault();
			nextUl.stop().slideToggle(300,
				function(){
					if (!thisA.hasClass('opened')){
						thisA.removeClass('closed').addClass('opened').find('.parent_blt').removeClass(icon_closed).addClass(icon_opened);
					}else{
						thisA.removeClass('opened').addClass('closed').find('.parent_blt').removeClass(icon_opened).addClass(icon_closed);
					}
				}
			);
			visUl.stop().slideToggle(300,
				function(){
					if (prevA.hasClass('opened')){
						prevA.removeClass('opened').addClass('closed').find('.parent_blt').removeClass(icon_opened).addClass(icon_closed);
					}
				}
			);
		}
	});
}

jQuery(document).ready(function() {

	table_responsive();
	initSwitcherMenu('.topmenu');
	initMenuAccordParents('.mdl_leftmenu');
	update_height_cols('mdl_service_popular','items_block');
});
jQuery(window).load(function() {
	footer_fix();
});
jQuery(window).resize(function() {
	update_height_cols('mdl_service_popular','items_block');
	footer_fix();
});

jQuery(window).ready(function() {
	 var delay_popup = 1000;
	 setTimeout("document.getElementById('overlay').style.display='block'", delay_popup);
});

